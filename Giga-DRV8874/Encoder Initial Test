#define PinEN 2
#define PinPH 22
#define PinPmode 23
#define PinSleep 24
#define PinSqA 25
#define PinSqB 26

int duty = 200;

volatile int lastinterrupt = 0, currinterrupt = 0,
         completed = 1;

void setup() {
    pinMode(PinEN,OUTPUT);
    pinMode(PinPH,OUTPUT);
    pinMode(PinPmode,OUTPUT);
    pinMode(PinSleep,OUTPUT);
    pinMode(PinSqA, INPUT);
    pinMode(PinSqB, INPUT);
    attachInterrupt(PinSqA, interruptservice, RISING);
    attachInterrupt(PinSqB, interruptservice, RISING);
    digitalWrite(PinPmode, LOW);
    delay(500);
    digitalWrite(PinSleep,HIGH);
}

void loop() {
  currinterrupt = millis();
  analogWrite(PinEN,duty);
  if(completed) digitalWrite(PinPH,HIGH);
  else digitalWrite(PinPH,LOW);
}

void interruptservice(){ //Cannot use delay or millis
    noInterrupts();
    if(currinterrupt-5000>lastinterrupt){
        lastinterrupt = currinterrupt;
        completed = !completed;
        digitalWrite(PinEN,LOW);
    }
    interrupts();
}